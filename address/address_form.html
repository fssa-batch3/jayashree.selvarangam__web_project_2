<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>coffee shop </title>

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
            integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="
            crossorigin="anonymous" referrerpolicy="no-referrer">
           
        <link rel="stylesheet" href="../../assets/css/profile.css">
        <link rel="stylesheet" href="../../assets/css/header.css">
        <link rel="stylesheet" href="../../assets/css/footer.css ">
        <link href="https://fonts.googleapis.com/css2?family=Aclonica&family=Merienda:wght@300;400;500;600&family=Montserrat:wght@400;500&family=Poppins:ital,wght@0,100;0,300;0,400;1,100;1,200;1,300;1,400&family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        <style>
          * { font-family: 'Aclonica', sans-serif;
font-family: 'Merienda', cursive;
font-family: 'Montserrat', sans-serif;
font-family: 'Poppins', sans-serif;
font-family: 'Quicksand', sans-serif;
        }
        .profile{
            height:120vh;
        }
        </style>
    </head>
    <body>
    
        <section class="profile" id="profile">

            <h1 class="heading">
              add  address 
            </h1>
         
            <form action="" >
                <!-- <i class="fa-solid fa-trash" id="delete"></i> -->
                <label>Address type:</label>
                <input type="text" value="Home" id="address-type" class="box" required>
                <label>House no:</label>
                <input type="number" value="15" id="house-no" class="box" required>
                <label>Area:</label>
                <input type="text" value=" kandaswamy st anna nagar "id="area"class="box" required>
                <label> pincode:</label>
                <input type="number" id="pincode" value="600002" maxlength="6" pattern="\d{6}" class="box" required>
                <label> district:</label>
                <input type="text" class="box" value="chennai"disabled>
              <!-- <select value="chennai">
                <option class="box" required>chennai</option>
              </select> -->
                <label for="default-address">default address</label>
                <input type="checkbox" id="default-address"  >
                <!-- <a href="../../pages/profile/profile_edit.html"><input type="submit" value="Edit" class="btn"></a>
                    <span class="save"> -->
                <!-- <button  class="btn" id="delete" >delete profile
                    </button>  -->
                <button type="button" class="btn" id="save">Save
                </button>
            </form>
        </section>

    </body>
    <script src="https://cdn.jsdelivr.net/npm/uuid@8.3.2/dist/umd/uuidv4.min.js"></script>
    <script>
        // const submit = document.getElementById('save')
        // submit.addEventListener('submit',function(){
            const user_id = JSON.parse(localStorage.getItem("unique_id"));
        const submit = document.getElementById('save')

        const pincodeInput = document.getElementById('pincode');
pincodeInput.addEventListener('blur', function() {
  const pincode = pincodeInput.value.trim();
  if (pincode !== '') {
    const pincodeRegex = /^6\d{5}$/; // regex pattern to match a pincode starting with 6 and having a total of 6 digits
    if (!pincodeRegex.test(pincode)) {
      alert('Invalid pincode! Please enter a valid pincode starting with 6 and having a total of 6 digits.');
    }
  }
});



        submit.addEventListener('click',function(){
    
            let address_type = document.getElementById('address-type').value
            let house_no = document.getElementById('house-no').value
            let area = document.getElementById('area').value
            let pincode = document.getElementById('pincode').value
            const checkbox = document.getElementById("default-address");
            const isChecked = checkbox.checked;
            let value;
            let address_array123 =[]
            let address_array = JSON.parse(localStorage.getItem('address'))
            if(isChecked===true && address_array===null){
                value=true;
            }else if(isChecked===true &&address_array!==null){
                let address_array = JSON.parse(localStorage.getItem('address'));
                address_array.forEach((object) => {
                object.value = false;
                localStorage.setItem('address',JSON.stringify(address_array))
    })
} 
else{
    value=false
            };
            let assign ;
            if(address_array!==null){
            for(let i=0;i<address_array.length;i++){
           if(house_no==address_array[i].house_no&&area==address_array[i].area){
            alert('Address already exist')
            assign = true;
            break;
           }
        }
       
    };
          if(assign !== true){
            if(address_array===null){
                if(address_type==''||house_no==""||area==""||pincode==""){
                alert('Please fill all the fields')
            }else{
              
              
                address_array = [
                    {
                address_type,
                house_no,
                area,
                pincode,
                'id':uuidv4(),
                district:'chennai',
                value:value,
                user_id

                    }
                
                ]
                localStorage.setItem('address',JSON.stringify(address_array))
                }
            }else{
               let address_array = JSON.parse(localStorage.getItem('address'))
               if(address_type==''||house_no==""||area==""||pincode==""){
                alert('Please fill all the fields')

            }else{
                address_array.push({    
                address_type,
                house_no,
                area,
                pincode,
                'id':uuidv4(),
                district:'chennai',
                value:value     
            })
            localStorage.setItem('address',JSON.stringify(address_array))
        }}
        location.href="../../address/address.html";
        }
    })

    
    
    </script>
    <script src="../../pages/order/header.js"></script>
    </html>